---
title: "HOWTO: æäº¤ä¸€ä¸ªè½¯ä»¶åŒ…åˆ° AUR"
summary: ç¬¬ä¸€æ¬¡æäº¤ AURï¼Œå¿ƒé‡Œæœ‰äº›å°æ¿€åŠ¨
publishDate: 2023-04-28 21:48:22
createdDate: 2023-04-28 10:11:59
star: false
showTOC: false
draft: false
# series:
cate:
  - default
tags:
  - default
---

æœ€è¿‘å‘ç°äº† [gptcommit][gptcommit]ï¼Œä¸€ä¸ªç”¨ Rust å†™çš„ä½¿ç”¨ gpt ç”Ÿæˆæäº¤ä¿¡æ¯çš„å°å·¥å…·ã€‚åŸç†å¤§æ¦‚æ˜¯å°† `git diff` çš„è¾“å‡ºå‘ç»™ gptï¼Œè®©å®ƒç”Ÿæˆå¯ä»¥å½“æäº¤ä¿¡æ¯çš„æ–‡æœ¬ï¼Œå¾ˆé€‚åˆæ‡’äººã€‚

<Dialog reverse={true}>
  <del className=" text-nord-3 line-through decoration-2 dark:text-nord-4/80">
    <>äººç±»çœŸçš„æ˜¯æ‡’åˆ°èµ·é£äº†</>
  </del>
  <> ğŸ˜‚</>
</Dialog>

åœ¨ AUR(Arch User Repository) ä¸Šæœ‰ [gptcommit-git](https://aur.archlinux.org/packages/gptcommit-git) åŒ…ï¼Œä½†æ˜¯ç‰ˆæœ¬åœç•™åœ¨ 0.1.16ï¼Œæ„Ÿè§‰å¯èƒ½æ˜¯ `PKGBUILD` å†™çš„æœ‰ç‚¹é—®é¢˜å¯¼è‡´å¸¸å¸¸å¾—æ‰‹åŠ¨æ›´æ–°ç‰ˆæœ¬ã€‚
å› ä¸º AUR ä¸­ä¹Ÿæ²¡æœ‰ `gptcommit-bin`ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†åç»­æ–¹ä¾¿ä¸€é”® `yay -Syu` æ›´æ–°ç‰ˆæœ¬ï¼Œæˆ‘å‡†å¤‡è‡ªå·±æ‰“ä¸ªåŒ…ä¸Šä¼ ï¼Œé¡ºä¾¿ä¹Ÿç»™ç¤¾åŒºåšç‚¹å¾®ä¸è¶³é“çš„è´¡çŒ® â˜ºã€‚

[gptcommit]: https://github.com/zurawiki/gptcommit
[gptcommit-bin]: https://aur.archlinux.org/packages/gptcommit-bin

é¦–å…ˆæŸ¥æ‰¾æœ€æƒå¨çš„ Arch Wiki çœ‹çœ‹è¯¥å¦‚ä½•åˆæ³•çš„å†™ä¸€ä¸ªåŒ…å¹¶ä¸Šä¼ ï¼ŒæŸ¥é˜…ä¸€ä¸‹ Arch æ‰“åŒ…å‡†åˆ™[^1]å’Œ Arch æäº¤å‡†åˆ™[^2]ï¼Œé—®é—® ChatGPT å‚è€ƒå‚è€ƒæ„è§ã€‚

![gptcommit - Release](/image/2023-04-28-20-44-42.png)

gptcommit çš„ä½œè€…åœ¨ [release](https://github.com/zurawiki/gptcommit/releases) ä¸­æä¾›äº†å„ä¸ªå¹³å°ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½ä¸‹æ¥è§£å‹æ”¾åœ¨ `/usr/bin` ç›®å½•ä¸‹å°±èƒ½ä½¿ç”¨äº†ï¼Œæ„Ÿè§‰ä¹Ÿæ²¡ä»€ä¹ˆéš¾çš„ã€‚
ä»¥ä¸‹å°±æ˜¯å†™å‡ºæ¥çš„ `PKGBUILD` æ–‡ä»¶ï¼Œå†™å¥½ä¹‹åï¼Œåªè¦ä½¿ç”¨ `makepkg -Acs` å‘½ä»¤ï¼Œå°±èƒ½åœ¨å½“å‰ç›®å½•ç”Ÿæˆ tarballï¼Œå†ä½¿ç”¨ `sudo pacman -U <tarball>pkg.tar.zst` å°±å®Œæˆå®‰è£…äº†ã€‚

```shell:PKGBUILD
# Maintainer: travismtg <travismtg@outlook.com>

pkgname=gptcommit-bin
pkgver=0.5.8
pkgrel=1
pkgdesc="A git prepare-commit-msg hook for authoring commit messages with GPT-3."
arch=('any')
url='https://github.com/zurawiki/gptcommit'
license=('MIT')
depends=()
conflicts=('gptcommit-git' 'gptcommit')
source=('https://github.com/zurawiki/gptcommit/releases/download/v0.5.8/gptcommit-x86_64-unknown-linux-gnu.tar.gz')
sha256sums=('d0efe345dd4b598a8c06bd9ba7036ae4e148141deb606c64e612e8959273cedc')

package() {
cd "$srcdir"
    mkdir -p "$pkgdir/usr/bin/"
tar zxvf gptcommit-x86_64-unknown-linux-gnu.tar.gz -C "$pkgdir/usr/bin/"
}
```

éªŒè¯å¯ä»¥æ­£å¸¸å®‰è£…ä¹‹åï¼Œå°±å¯ä»¥å‡†å¤‡ä¸Šä¼ çš„äº‹æƒ…äº†ã€‚

1. é¦–å…ˆæ³¨å†Œä¸€ä¸ª AUR è´¦å·ï¼Œæ³¨å†Œå®Œä¹‹åè®¾ç½®ä¸€ä¸‹ ssh çš„å…¬é’¥æ¥è¯æ˜æˆ‘æ˜¯æˆ‘è‡ªå·±ã€‚
2. ç„¶åå°±å¯ä»¥æ–°å»ºä»“åº“äº†ï¼Œç›´æ¥ä½¿ç”¨ `git clone ssh://aur@aur.archlinux.org/gptcommit-bin.git` åˆ›å»ºè¿œç«¯ä»“åº“<small>ï¼ˆæ²¡é”™ï¼Œç›´æ¥ clone å°±èƒ½åˆ›å»ºä»“åº“ï¼‰</small>
3. ç„¶åæŠŠæˆ‘åˆšåˆšå†™å¥½çš„ `PKGBUILD` æ–‡ä»¶æ”¾è¿›å»ï¼Œä½¿ç”¨ `makepkg --printsrcinfo > .SRCINFO` ç”ŸæˆåŒ…åŸºæœ¬ä¿¡æ¯æ–‡ä»¶
4. `git add PKGBUILD .SRCINFO && git commit -m "v0.5.8"`
5. `git push --set-upstream origin master` æ¨åˆ°è¿œç«¯

<Dialog reverse={true}>
  åˆ°è¿™é‡Œå·²ç»å¯ä»¥çœ‹åˆ°æˆ‘å‘å¸ƒçš„åŒ…
  [gptcommit-bin](https://aur.archlinux.org/packages/gptcommit-bin)
  åœ¨ç½‘é¡µä¸Šå‡ºç°äº†ã€‚
</Dialog>
<Dialog reverse={true}>
  ä½†æ˜¯æ—¢ç„¶åšäº†ï¼Œå¹²è„†å˜å¾—å†è‡ªåŠ¨åŒ–ä¸€äº›ï¼Œæ¯æ¬¡æœ‰äº†æ–°ç‰ˆæœ¬è®©å®ƒè‡ªå·±æ›´æ–°å§ã€‚æ¯æ¬¡æœ‰äº†æ–°ç‰ˆæœ¬éƒ½æ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·ï¼Œä¸‹è½½åœ°å€ä»¥åŠ
  sha256 ä¿¡æ¯æ„Ÿè§‰ä¹ŸæŒºç´¯çš„ã€‚
</Dialog>

```shell:update.sh {9-10}
#!/usr/bin/env bash
# Created by travismtg
# Thu Apr 27 11:08:31 PM CST 2023
# usage: ./update.sh /path/to/pkg

DES=$1 # directory that contains the PKGBUILD file
cd $DES

VERSION_URL=`curl -s https://api.github.com/repos/zurawiki/gptcommit/releases/latest |\
    jq -r '.tag_name as $version | .assets[] | select(.name | contains("linux-gnu")) | $version + " " + .browser_download_url'`

VERSION=$(echo $VERSION_URL | cut -d' ' -f1 | sed 's/v//')
CURRENT_VERSION=$(grep 'pkgver=' PKGBUILD | sed 's/pkgver=//')
echo latest version is $VERSION
echo current version is $CURRENT_VERSION

if [[ $VERSION == $CURRENT_VERSION ]]; then
    echo exit
    exit
fi

URL=`echo $VERSION_URL | cut -d' ' -f2`
POSTURL=$(echo $URL | sed 's/\//\\\//g')

TARGET=$(echo $URL | grep -o 'gptcommit-x86.*tar.gz')
wget $URL -O $TARGET
SUM=$(sha256sum $TARGET | cut -f1 -d' ')

sed -i 's/^source=(.*)/source=('"'"$POSTURL"'"')/' PKGBUILD
sed -i 's/^sha256sums=(.*)/sha256sums=('"'"$SUM"'"')/' PKGBUILD
sed -i 's/^pkgver=.*/pkgver='$VERSION'/' PKGBUILD

makepkg --printsrcinfo > .SRCINFO

# commit and push
git add PKGBUILD .SRCINFO
git commit -m "$VERSION"
git push

```

æ¯æ¬¡æˆ‘åªéœ€è¦ `./update.sh /path/to/pkg` å°±èƒ½æ›´æ–°åŒ…æ–‡ä»¶äº†ã€‚æŠŠè¿™äº›æ–‡ä»¶æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œè®¾ç½®ä¸€ä¸‹ `crontab` å®šæ—¶æ¯å¤©æ—©ä¸Š 10 ç‚¹æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†è‡ªåŠ¨æ›´æ–° gptcommit åŒ…çš„ç›®çš„ã€‚

æœ¬æ–‡åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œè¿‡ç¨‹ä¸­æˆ‘æœ€å¤§çš„æ„Ÿå—æ˜¯ ChatGPT çœŸçš„æ˜¯å¤ªå¥½ç”¨äº†ï¼Œæˆ‘åªéœ€è¦é—®å®ƒè¯¥æ€ä¹ˆè·å– github æŸä¸€ä»“åº“çš„æœ€æ–° releaseï¼Œå¹¶ç­›é€‰å‡º linux çš„ä¸‹è½½é“¾æ¥ï¼Œå®ƒå¯ä»¥å¾ˆå¿«çš„æ›¿æˆ‘æ‰¾åˆ° github api å¹¶ä¸”æ›¿æˆ‘å†™å¥½`jq` çš„è§„åˆ™ã€‚
å½“ç„¶ï¼Œè¿™äº›ä¸œè¥¿è‡ªå·±æŸ¥é˜…æ–‡æ¡£ï¼Œæˆ–è€…å» Google ä¸€ä¸‹è‚¯å®šèƒ½æå®šï¼Œä½†æ˜¯ ChatGPT æ›¿æˆ‘å‹ç¼©äº†çŸ¥è¯†è·å–çš„æ—¶é—´ï¼Œèƒ½å¤Ÿä¸ªæ€§åŒ–çš„æ¨ç†å‡ºæˆ‘æƒ³è¦çš„ä¸œè¥¿ï¼Œè¿™ä¸ªæ°¸è¿œä¸ä¼šåŒçƒ¦çš„è€å¸ˆå®åœ¨æ˜¯å¤ªæ£’äº†ã€‚

---

[^1]: https://wiki.archlinux.org/title/AUR_submission_guidelines
[^2]: https://wiki.archlinux.org/title/Arch_package_guidelines
